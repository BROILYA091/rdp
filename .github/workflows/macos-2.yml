name: MacOs 2

on: workflow_dispatch

jobs: build:

runs-on: macOS-latest

steps:
- name: Download
  run: curl -O https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-stable-darwin-amd64.zip
- name: Extract
  run: unzip ngrok-stable-darwin-amd64.zip
- name: Auth
  run: ./ngrok/ngrok authtoken $NGROK_AUTH_TOKEN
  env:
    NGROK_AUTH_TOKEN: ${{ secrets.NGROK_AUTH_TOKEN }}
- name: Enable VNC
  run: sudo /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart -activate -configure -access -on -restart -agent -privs -all
- run: sudo launchctl load -w /System/Library/LaunchDaemons/com.apple.screensharing.plist
- run: sudo launchctl load -w /System/Library/LaunchAgents/com.apple.screensharing.agent.plist
- run: sysadminctl -addUser runner -password "q1qq1q" -admin
- name: Create Tunnel
  run: ./ngrok/ngrok tcp 5900
